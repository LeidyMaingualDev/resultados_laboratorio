<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro</title>
    <link rel="stylesheet" href="../static/css/styles.css">
</head>

<body>
    <div class="login-container">
        <div class="login-card">
            <h2 class="login-title">Crear cuenta</h2>
            <p class="login-subtitle">Completa tus datos para registrarte</p>

            <form id="registerForm">
                <div class="form-group">
                    <input type="text" id="nombreCompleto" placeholder="Nombre completo" required>
                </div>
                <div class="form-group">
                    <input type="text" id="tipoDocumento" placeholder="Tipo de documento (CC, TI, CE)" required>
                </div>
                <div class="form-group">
                    <input type="text" id="documento" placeholder="Número de documento" required>
                </div>
                <div class="form-group">
                    <input type="number" id="numero" placeholder="Número de teléfono" required>
                </div>
                <div class="form-group">
                    <select id="role" required>
                        <option value="">Selecciona un rol</option>
                        <option value="DOCTOR">Doctor</option>
                        <option value="LABORATORISTA">Laboratorista</option>
                    </select>
                </div>
                <div class="form-group">
                    <select id="especialidad" required>
                        <option value="">Selecciona tu especialidad</option>
                        <option value="GENERAL">General</option>
                        <option value="CLINICA">Clínica</option>
                        <option value="MICROBIOLOGIA">Microbiología</option>
                    </select>
                </div>
                <div class="form-group">
                    <input type="email" id="email" placeholder="Correo electrónico" required>
                </div>
                <div class="form-group">
                    <input type="password" id="password" placeholder="Contraseña" required>
                </div>

                <button type="submit" class="btn-login">Registrarse</button>
            </form>

            <p class="register-text">
                ¿Ya tienes cuenta? <a href="index.html">Inicia sesión</a>
            </p>
        </div>
    </div>

    <script>
        const form = document.getElementById("registerForm");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            // Captura los datos del formulario
            const data = {
                nombreCompleto: document.getElementById("nombreCompleto").value,
                tipoDocumento: document.getElementById("tipoDocumento").value,
                documento: document.getElementById("documento").value,
                numero: document.getElementById("numero").value,
                role: document.getElementById("role").value,
                especialidad: document.getElementById("especialidad").value,
                email: document.getElementById("email").value,
                password: document.getElementById("password").value
            };

            try {
                const response = await fetch("http://localhost:8080/auth/register", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                });

                if (!response.ok) {
                    throw new Error("Error al intentar el registro");
                }

                const user = await response.json();

                alert("Registro exitoso, ahora puedes iniciar sesión " + user.nombreCompleto);

                window.location.href = "index.html";
            } catch (error) {
                alert("Error: " + error.message);
            }
        });
    </script>
</body>
</html>
